#!/usr/bin/env bash
set -euo pipefail

SUPABASE="supabase"

reverted=(
  20250922032140
  20250922034647
  20250922035449
  20250922035546
  20250922045730
  20250922050612
  20250922055213
  20250922060337
  20250922060432
  20250922060516
  20250922060541
  20250922060633
  20250922060701
  20250922060817
  20250922064405
  20250922065406
  20250922065434
  20250922065504
  20250922081051
  20250922081114
  20250922083243
  20250922083305
  20250922090629
  20250922091216
  20250922092738
  20250922093203
  20250923012519
)

applied=(
  20250918084216
  20250922032143
  20250922032203
  20250922034610
  20250922034628
  20250922034650
  20250922034801
  20250922035452
  20250922035517
  20250922035548
  20250922045733
  20250922050615
  20250922055215
  20250922060339
  20250922060407
  20250922060434
  20250922060518
  20250922060544
  20250922060604
  20250922060635
  20250922060705
  20250922060756
  20250922060819
  20250922064408
  20250922065409
  20250922065437
  20250922065509
  20250922081053
  20250922081115
  20250922083245
  20250922083307
  20250922090632
  20250922090709
  20250922091219
  20250922091359
  20250922092740
  20250922092802
  20250922093025
  20250922093049
  20250922093110
  20250922093134
  20250922093205
  20250922093322
  20250923012521
  20250923094500
  20250923100500
  20250923102000
  20250923104530
  20250923111500
  20250923111600
  20250923120010
  20250923123000
)

run_repairs() {
  for id in "${reverted[@]}"; do
    echo "Marking migration ${id} as reverted"
    ${SUPABASE} migration repair --status reverted "${id}"
  done

  for id in "${applied[@]}"; do
    echo "Marking migration ${id} as applied"
    ${SUPABASE} migration repair --status applied "${id}"
  done
}

run_repairs

echo "Migration repair commands completed."
